---
nav:
  title: å¤ç›˜
  order: 5
group: '2024'
toc: content
---
## 1. ProTableé™æ€è¿‡æ»¤

æ³¨æ„ `fieldProps` æ·»åŠ  `onChange` é¡»åˆ¤æ–­æ˜¯å¦ä¸ºç¼–è¾‘çŠ¶æ€, å¦åˆ™ `Table` ç¼–è¾‘æ—¶ä¼šè§¦å‘ `onChange` äº‹ä»¶
```js
const columns = [
  {
    ...,
    fieldProps: (_: any, { isEditable }: any) => ({
      onChange: !isEditable ? setValue : null,
    }),
  }
]
```
## 2. splitæ–¹æ³•
  - ç©ºå­—ç¬¦ä¸²çš„åˆ†å‰²;
  ```js
  const result = "".split(",");
  console.log(result);
  // è¾“å‡º: [''] ï¼ˆéžç©ºæ•°ç»„ï¼ŒåŒ…å«ä¸€ä¸ªç©ºå­—ç¬¦ä¸²ï¼‰
  ```
  åŽŸå› ï¼š

  ç©ºå­—ç¬¦ä¸²æ²¡æœ‰å†…å®¹ï¼Œsplit() é»˜è®¤è¿”å›žä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«åŽŸå§‹å­—ç¬¦ä¸²ã€‚è§£å†³æ–¹æ¡ˆï¼š
  ```js
  const result = "".split(",").filter(Boolean);
  console.log(result);
  // è¾“å‡º: [] ï¼ˆä½¿ç”¨ filter ç§»é™¤ç©ºå­—ç¬¦ä¸²ï¼‰
  ```
  - å¤šä½™åˆ†éš”ç¬¦

  ```js
    const text = ",,è‹¹æžœ,,åŽä¸º,,";
    const result = text.split(",");
    console.log(result);
    // è¾“å‡º: ['', '', 'è‹¹æžœ', '', 'åŽä¸º', '', '']
  ```
  åŽŸå› ï¼š

  è¿žç»­çš„åˆ†éš”ç¬¦ä¼šåœ¨æ•°ç»„ä¸­æ’å…¥ç©ºå­—ç¬¦ä¸²ã€‚è§£å†³æ–¹æ¡ˆï¼š
  ```js
  const text = ",,è‹¹æžœ,,åŽä¸º,,";
  const result = text.split(",").filter(Boolean);
  console.log(result);
  // è¾“å‡º: ['è‹¹æžœ','åŽä¸º']
  ```
  - åˆ†å‰² Unicode å­—ç¬¦
  ```js
  const text = "ðŸ‘ðŸ˜ŠðŸ‘¨â€ðŸ‘©â€ðŸ‘¦";
  const result = text.split('');
  console.log(result);
  // è¾“å‡º: ['ðŸ‘', 'ðŸ˜Š', 'ðŸ‘¨', 'â€', 'ðŸ‘©', 'â€', 'ðŸ‘¦']
  ```
  åŽŸå› ï¼š

  split("") æŒ‰å­—èŠ‚åˆ†å‰²ï¼Œæ— æ³•æ­£ç¡®è¯†åˆ«ç»„åˆåž‹å­—ç¬¦ã€‚è§£å†³æ–¹æ¡ˆï¼š
  ```js
  const text = "ðŸ‘ðŸ˜ŠðŸ‘¨â€ðŸ‘©â€ðŸ‘¦";
  const result = Array.from(text);
  console.log(result);
  // è¾“å‡º: ['ðŸ‘', 'ðŸ˜Š', 'ðŸ‘¨â€ðŸ‘©â€ðŸ‘¦'] ï¼ˆå®Œæ•´åˆ†å‰²ï¼‰
  ```
## 3. ProLayout siderBaræ”¶èµ·submenuæœ€å¤§é«˜åº¦é—®é¢˜

siderBar æ”¶èµ·æ—¶submenuæœ€å¤§é«˜åº¦  `max-height: calc(100vh - 100px)`ï¼Œè€Œå®šä½èµ·å§‹ä½ç½®åœ¨é¼ æ ‡è§¦å‘ç‚¹ï¼Œsubmenuçš„é«˜åº¦å¯èƒ½æº¢å‡ºé¡µé¢ï¼Œå¯¼è‡´éƒ¨åˆ†èœå•è¢«é®æŒ¡ï¼Œæ— æ³•æ“ä½œï¼›

å¤„ç†åŠžæ³•ï¼š
- è®¾ç½®æœ€å¤§é«˜åº¦`50vh`,æˆ–è€…`calc(100vh - èœå•offsetTopï¼ŒoffsetBottom è¾ƒå°å°å€¼)`
- åŒæ—¶æœ€å¥½è®¾ç½®æœ€å°å€¼;
```css
.ant-menu-submenu-popup .ant-menu-vertical.ant-menu-sub {
  max-height: 50vh !important;
  min-height: 120px;
}
```
## 4. CSVè½¬æ•°ç»„

```js
export const csvToArray = (csv: string): string[][] => {
  const table = [] as string[][];
  let row: string[] = [];
  let cell = '';
  let openQuote = false;
  let i = 0;
  const len = csv.length;

  const pushCell = () => {
    row.push(cell);
    cell = '';
  };

  const pushRow = () => {
    pushCell();
    table.push(row);
    row = [];
  };
  // å¤„ç†è¡Œåˆ†éš”ç¬¦å’Œåˆ—åˆ†éš”ç¬¦
  const handleSeparator = () => {
    const c = csv.charAt(i);
    if (i + 1 >= len) {
      pushRow();
    } else if (c === COLUMN_DELIMITER) {
      pushCell();
    } else if (c === '\r') {
      if (csv.charAt(i + 1) === '\n') {
        i++;
      }
      pushRow();
    } else if (c === '\n') {
      pushRow();
    } else {
      return false;
    }
    return true;
  };
  while (i < len) {
    const c = csv.charAt(i);
    const next = csv.charAt(i + 1);
    if (!openQuote && !cell && c === '"') {
      // é‡åˆ°å•å…ƒç¬¬ä¸€ä¸ªå­—ç¬¦ä¸ºåŒå¼•å·æ—¶å‡è®¾æ•´ä¸ªå•å…ƒéƒ½æ˜¯è¢«åŒå¼•å·æ‹¬èµ·æ¥
      openQuote = true;
    } else if (openQuote) {
      // åŒå¼•å·è¿˜æœªæˆå¯¹çš„æ—¶å€™
      if (c !== '"') {
        // å¦‚éžåŒå¼•å·ï¼Œç›´æŽ¥æ·»åŠ è¿›å•å…ƒå†…å®¹
        cell += c;
      } else if (next === '"') {
        // å¤„ç†åŒå¼•å·è½¬ä¹‰
        cell += c;
        i++;
      } else {
        // ç¡®è®¤å•å…ƒç»“æŸ
        openQuote = false;
        if (!handleSeparator(++i)) {
          throw new Error('Wrong CSV format!');
        }
      }
    } else if (!handleSeparator(i)) {
      // æ²¡æœ‰åŒå¼•å·åŒ…èµ·æ¥æ—¶ï¼Œå¦‚éžè¡Œåˆ—åˆ†éš”ç¬¦ï¼Œä¸€å¾‹ç›´æŽ¥åŠ å…¥å•å…ƒå†…å®¹
      cell += c;
    }
    i++;
  }
  if (cell) {
    pushRow();
  }
  return table;
};
```
## 5. pdfjs-dist

```ts
import { GlobalWorkerOptions, getDocument } from 'pdfjs-dist';

import {
  EventBus,
  NullL10n,
  PDFFindController,
  PDFLinkService,
  PDFScriptingManager,
  PDFViewer,
} from 'pdfjs-dist/web/pdf_viewer';
import 'pdfjs-dist/web/pdf_viewer.css';
import { useCallback, useMemo, useRef } from 'react';

if (GlobalWorkerOptions) {
  GlobalWorkerOptions.workerSrc = new URL(
    'pdfjs-dist/build/pdf.worker.min.js',
    import.meta.url,
  ).toString();
}
const CMAP_URL = 'cmaps/';
const STANDARD_FONT_DATA_URL = 'standard_fonts/';
const CMAP_PACKED = true;
const ENABLE_XFA = true;
const SANDBOX_BUNDLE_SRC = new URL(
  'pdfjs-dist/build/pdf.sandbox.js',
  import.meta.url,
).toString();

const usePDFPreview = (container: React.RefObject<HTMLDivElement>) => {
  const viewRef = useRef<PDFViewer>();
  const eventBus = useMemo(() => new EventBus(), []);
  const preview = useCallback(
    async (base64: string) => {
      if (!container.current) {
        return;
      }
      const pdfLinkService = new PDFLinkService({
        eventBus,
      });
      const pdfFindController = new PDFFindController({
        eventBus,
        linkService: pdfLinkService,
      });
      const pdfScriptingManager = new PDFScriptingManager({
        eventBus,
        sandboxBundleSrc: SANDBOX_BUNDLE_SRC,
      });
      while (container.current.firstChild) {
        container.current.removeChild(container.current.firstChild);
      }
      container.current.classList.add('pdfViewer');
      const pdfViewer = new PDFViewer({
        eventBus,
        viewer: container.current,
        container: container.current,
        linkService: pdfLinkService,
        findController: pdfFindController,
        scriptingManager: pdfScriptingManager,
        l10n: NullL10n,
        removePageBorders: true,
        // pageColors: {
        //   foreground: 'red',
        //   background: 'Canvas',
        // },
      });

      pdfLinkService.setViewer(pdfViewer);
      pdfScriptingManager.setViewer(pdfViewer);
      const loadingTask = getDocument({
        data: window.atob(base64),
        cMapUrl: CMAP_URL,
        cMapPacked: CMAP_PACKED,
        enableXfa: ENABLE_XFA,
        standardFontDataUrl: STANDARD_FONT_DATA_URL,
        disableFontFace: false,
      });
      const pdfDocument = await loadingTask.promise;
      pdfViewer.setDocument(pdfDocument);
      pdfLinkService.setDocument(pdfDocument, null);
      viewRef.current = pdfViewer;
    },
    [container, eventBus],
  );
  const onSearch = (query?: string) => {
    if (!viewRef.current || !query) {
      return;
    }
    viewRef.current.eventBus.dispatch('find', {
      query, // æŸ¥è¯¢å­—æ®µ
      phraseSearch: true, // æ˜¯å¦çŸ­è¯­æŸ¥æ‰¾
      findPrevious: true, // æ˜¯å¦å¾ªçŽ¯æŸ¥æ‰¾
      highlightAll: true, // æ˜¯å¦é«˜äº®
      caseSensitive: true, // åŒºåˆ†å¤§å°å†™
      entireWord: true, // æ•´ä¸ªå•è¯ç²¾ç¡®æŸ¥æ‰¾
    });
  };
  return {
    onSearch,
    preview,
  };
};

export default usePDFPreview;
```
å­—ä½“è§£æž
```js
import path from 'node:path';
const pdfjsDistPath = path.dirname(require.resolve('pdfjs-dist/package.json'));
const cMapsDir = path.join(pdfjsDistPath, 'cmaps');
const fontsDir = path.join(pdfjsDistPath, 'standard_fonts');

const defineConfig = {
  ...
  copy: [
    { from: cMapsDir, to: 'dist/static/cmaps/' },
    { from: fontsDir, to: 'dist/static/standard_fonts/' },
  ],
}
```
## 6. `visibilitychange`
ç›‘æŽ§é¡µé¢æ˜¯å¦å¯è§ 
```js
document.addEventListener("visibilitychange", () => {
  console.log(document.hidden);
  // ä¿®æ”¹è¡Œä¸ºâ€¦â€¦
});
```
## 7. `fullscreenchange`
ç›‘æŽ§æµè§ˆå™¨è¿›å…¥æˆ–é€€å‡ºå…¨å±æ¨¡å¼
```js
addEventListener("fullscreenchange", (event) => {});
```
`hashchange`
`pagehide`
`pageshow`
